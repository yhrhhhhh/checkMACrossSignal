# 期货信号预警策略使用手册

## 1. 概述

本策略代码主要用于监控期货合约（示例合约：603300.SH）的实时K线数据，计算短期和长期均线，并检测均线交叉（即金叉和死叉）信号。一旦检测到最新数据产生金叉或死叉信号，系统会通过邮件自动发送预警通知。

## 2. 环境要求

- **Python 版本**：建议使用 Python 3.6 及以上版本

- 依赖库

  ： 

  - `tushare`：用于获取期货实时数据
  - `pandas`：数据处理与计算
  - `numpy`：数值计算
  - `smtplib`、`email`：用于发送邮件
  - `logging`：日志记录

可通过以下命令安装所需库（如尚未安装）：

```bash
pip install tushare pandas numpy
```

## 3. 配置

### 3.1 Tushare API 配置

- 在代码中调用 

  ```
  ts.set_token("")
  ```

  ，请替换为你自己的 Tushare Token： 

  ```python
  ts.set_token("你的TushareToken")
  ```

- 确保 Tushare API 能正常返回实时期货数据。

### 3.2 策略参数

- **SHORT_MA**：短期均线周期（默认为5）。
- **LONG_MA**：长期均线周期（默认为20）。
- **SYMBOL**：期货合约代码（示例中使用 '603300.SH'）。
- **FREQ**：K线周期（示例为 '15MIN'）。

这些参数均可在代码开头的策略参数配置部分进行修改。

### 3.3 邮件配置

- **FROM_EMAIL**：发送预警邮件的邮箱地址。
- **TO_EMAIL**：接收预警邮件的邮箱地址。
- **SMTP_SERVER** 和 **SMTP_PORT**：邮件服务器地址与端口（示例使用 QQ 邮箱：`smtp.qq.com`，端口 465）。
- **EMAIL_PASSWORD**：对应邮箱的授权码（注意：不是登录密码）。

请确保邮箱的授权码配置正确，以便邮件能够正常发送。

## 4. 代码结构说明

- **generate_test_data**：用于生成模拟数据（仅用于测试）；生成的数据包含时间、开盘价、收盘价、最高价、最低价、成交量、持仓量。
- **get_tushare_futures_data**：通过 Tushare API 获取实时期货数据；包含数据清洗和索引整理步骤。
- **calculate_ma**：对数据中的收盘价计算短期均线（Short_MA）和长期均线（Long_MA）。
- **detect_cross**：检测均线交叉信号，判断是否出现金叉（Signal=1）或死叉（Signal=-1）。
- **send_email_alert**：当检测到信号时，通过 SMTP 发送邮件预警。
- **strategy_main**：策略的主逻辑，依次调用上述函数获取数据、计算均线、检测信号，并在检测到最新K线产生金叉或死叉时触发邮件预警。

## 5. 运行方式

确保已正确配置 Tushare Token 和邮件授权码后，直接运行脚本即可：

```bash
python your_script_name.py
```

脚本运行过程中：

- 日志会同时输出到控制台和 `futures_strategy.log` 文件中；
- 如果获取数据、计算均线或检测信号出现异常，会记录日志；
- 若最新一根K线（或最后10条数据中的信号）触发了金叉或死叉，将会自动发送预警邮件。

## 6. 工作流程

1. **数据获取**：首先尝试从 Tushare API 获取实时期货数据。如果获取失败，则记录日志并退出。
2. **指标计算**：对获取的数据计算短期和长期均线，取最近100个有效数据。
3. **信号检测**：通过比较相邻两根K线的均线关系，确定是否刚刚出现金叉或死叉。
4. **预警触发**：检查最新数据的 Signal 值，如果不为0，则根据值判断信号类型（1为金叉，-1为死叉），并发送邮件通知。

## 7. 注意事项

- **重复报警**：当前逻辑只对最新一根数据判断是否触发信号。为避免重复报警，建议在实际部署中增加状态记录，只有当信号状态发生变化时才发送预警。
- **测试与实盘**：在部署到实际交易环境之前，建议使用模拟数据（使用 generate_test_data 函数）进行充分测试，确保各模块协同工作正常。
- **日志监控**：查看 `futures_strategy.log` 文件可以帮助快速定位问题。

## 8. 调试与扩展

- 如需调试，可在各关键步骤增加调试输出（例如打印数据 DataFrame 的部分内容）。
- 可扩展其他信号检测逻辑，例如连续信号确认、不同周期均线等。
- 若需要支持多合约监控，只需在策略主逻辑中循环处理多个 SYMBOL。

------

